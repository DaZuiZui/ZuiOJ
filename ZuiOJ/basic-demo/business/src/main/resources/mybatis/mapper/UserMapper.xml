<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dazuizui.business.mapper.UserMapper">
    <!--
        物理删除用户通过id
    -->
    <delete id="deleteUserById">
        delete from
            user
        where
            id = #{id}
    </delete>

    <!--
        Tombstone users in batchers
        批量逻辑删除用户
    -->
    <update id="tombstoneUsersInBatches">
        update
            user
        set
            del_flag  = 1
        where
            id
        in
        <foreach collection="delArr" item="obj" open="(" separator="," close=")">
            #{obj}
        </foreach>;
    </update>

    <!--
        通过id批量获取username
    -->
    <select id="getDateInBatches" resultType="string">
        select
            username
        from 
            user
        where 
            id 
        in
            <foreach collection="delArr" item="obj" open="(" separator="," close=")">
                #{obj}
            </foreach>
        ;
    </select>

    <!--
        管理员分页获取学生数据
    -->
    <select id="pagingToGetUserDate" resultType="com.dazuizui.basicapi.entry.User">
        select
            *
        from
            user
        limit
            #{pages},#{numbers}
    </select>

    <!--
        查询用户数量
    -->
    <select id="queryCountOfUser" resultType="long">
        select
            count(0)
        from
            user
    </select>

    <!--
        通过id查询用户
    -->
    <select id="queryUserById" resultType="com.dazuizui.basicapi.entry.User">
        select
            id,
            username,
            student_id,
            name,
            sex,
            password,
            id_card,
            college_id,
            major_id,
            class_id,
            role,
            grade,
            status,
            head_portrait
        from
            user
        where
            id = #{id}
        limit 1
    </select>

    <!--
        根据用户名或者学号查询用户 只获取一个
    -->
    <select id="checkUsernameAndStudentId" resultType="com.dazuizui.basicapi.entry.User">
        select
            id
        from
            user
        where
            username = #{username} or
            student_id = #{studentId}
        limit 1
    </select>


    <!--
        根据username查询用户
    -->
    <select id="userLogin" resultType="com.dazuizui.basicapi.entry.User">
        select
            id,
            username,
            student_id,
            name,
            sex,
            password,
            id_card,
            college_id,
            major_id,
            class_id,
            role,
            grade,
            status,
            head_portrait
        from
            user
        where
            username = #{username}
        limit 1
    </select>


    <insert id="register">
        insert into
            user
        value(
            null,
            #{username},
            #{studentId},
            #{name},
            #{sex},
            #{password},
            '',
            #{collegeId},
            #{majorId},
            #{classId},
            1,
            2021,
            #{year},
            #{mouth},
            '',
            #{createTime},
            null,
            null,
            #{updateTime},
            #{updateById},
            #{updateByName},
            0,
            0
        )
    </insert>
</mapper>